" Change mapleader key
let mapleader = ','

" Some helpers to edit mode
" http://vimcasts.org/e/14
cnoremap %% <C-R>=escape(expand('%:h'), ' ').'/'<cr>

map <Leader>ef  :e %%
map <Leader>el  :e .lvimrc<cr>
map <Leader>eb :e ~/.vim/vimrc.bindings"<cr><cr>
map <Leader>ev :e ~/Dropbox/Notes/vim-cheatsheet.txt<cr>
map <Leader>ec :e ~/Dropbox/Notes/coding-journals.txt<cr>
map <Leader>ed :e ~/Dropbox/Notes/debugging-journals.txt<cr>
map <Leader>en :e ~/Dropbox/Notes/nca-journals.txt<cr>
map <Leader>ej :e ~/Dropbox/Notes/sagacity-journals.txt<cr>
map <Leader>es :UltiSnipsEdit<cr>

map <Leader>0 :e#<cr>
map <Leader>1 :1b<cr>
map <Leader>2 :2b<cr>
map <Leader>3 :3b<cr>
map <Leader>4 :4b<cr>
map <Leader>5 :5b<cr>
map <Leader>6 :6b<cr>
map <Leader>7 :7b<cr>
map <Leader>8 :8b<cr>
map <Leader>9 :9b<cr>

imap <C-c> <esc>:<Space>
" Note that remapping C-s requires flow control to be disabled
" (e.g. in .bashrc or .zshrc)
map <C-s> <esc>:w<CR>
imap <C-s> <esc>:w<CR>
map <C-c><C-n> :cn<CR>
map <C-c><C-p> :cp<CR>
map ; :

map <Leader>s :set spell!<cr>

" xnoremap <f1> "zy:!firefox "http://www.google.com/search?q=<c-r>=substitute(@z,' ','%20','g')<cr>"<return>gv

" Vundle
map <Leader>sb  :source ~/.vimrc<cr>
nmap <Leader>sp :source ~/.vimrc<cr>:PluginInstall<cr>

map <Leader>cp ggVG"*y
map <Leader>p :set paste<cr>o<esc>"*]p:set nopaste<cr>


" Breaking lines with \[enter] without having to go to insert mode (myself).
nmap <leader><cr> i<cr><Esc>

" F9  - Run external make command
noremap <silent> <f9> :echo "Running waf..."<cr>:sil! ./waf<cr>:cw<cr>:redraw!<cr>:echo "waf complete."<cr>

" Toggle paste mode
nmap <silent> <Leader>sip :set invpaste<cr>:set paste?<cr>

" Turn off that stupid highlight search
nmap <silent> <Leader>hls :set invhls<cr>:set hls?<cr>

" Set text wrapping toggles
nmap <silent> <Leader>siw :set invwrap<cr>:set wrap?<cr>

" Set up retabbing on a source file
nmap <silent> <Leader>rr :1,$retab<cr>

" cd to the directory containing the file in the buffer
nmap <silent> <Leader>cd :lcd %:h<cr>
nmap <silent> <Leader>md :!mkdir -p %:p:h<cr>

" execute contents of register "
nmap <silent> <Leader>rc :@"<cr>

" saving and resoring session
map <S-F5> :execute "source ".input("Load session: ", "~/.vim/session/", "file")<cr>
map <F5> :execute "mksession! ".input("Save session: ", "~/.vim/session/", "file")\| :echo "Session saved."<CR>

" Emacs-like beginning and end of line.
imap <c-e> <c-o>$
imap <c-a> <c-o>^

map <Leader>sh  :sp %%
map <Leader>sv  :vsp %%

" buffer key mapping
noremap <silent> <C-Tab> :bnext<cr>
noremap <silent> <C-S-Tab> :bprevious<cr>

" simplified buffer flipping
noremap <silent> <C-H> :wincmd h<cr>
noremap <silent> <C-L> :wincmd l<cr>
noremap <silent> <C-J> :wincmd j<cr>
noremap <silent> <C-K> :wincmd k<cr>

" re-assign all windows keys
noremap <silent> <Leader>h :wincmd h<cr>
noremap <silent> <Leader>j :wincmd j<cr>
noremap <silent> <Leader>k :wincmd k<cr>
noremap <silent> <Leader>l :wincmd l<cr>

noremap <silent> <Leader>sp     :wincmd p<cr>
noremap <silent> <Leader>se     :wincmd =<cr>
noremap <silent> <Leader>sh+    :resize +10'<cr>
noremap <silent> <Leader>sh-    :resize -10'<cr>
noremap <silent> <Leader>sv+    :vertical resize +10<cr>
noremap <silent> <Leader>sv-    :vertical resize -10<cr>

" close windows
noremap <silent> <Leader>cj :wincmd j<cr>:close<cr>
noremap <silent> <Leader>ck :wincmd k<cr>:close<cr>
noremap <silent> <Leader>ch :wincmd h<cr>:close<cr>
noremap <silent> <Leader>cl :wincmd l<cr>:close<cr>
noremap <silent> <Leader>cx :close<cr>
noremap <silent> <Leader>co :only<cr>

" windows placeme<Leader>
noremap <silent> <Leader>ml :wincmd L<cr>
noremap <silent> <Leader>mk :wincmd K<cr>
noremap <silent> <Leader>mh :wincmd H<cr>
noremap <silent> <Leader>mj :wincmd J<cr>

noremap <silent> <Leader>bd :bd<cr>

noremap <silent> <Leader>^ :setl hls<cr>:let @/="<C-r><C-w>"<cr>
noremap <silent> <Leader>vgs :vimgrep /<C-r>// %<cr>:ccl<cr>:cwin<cr><C-W>J:set nohls<cr>
noremap <silent> <Leader>vgw :vimgrep /<C-r><C-w>/ %<cr>:ccl<cr><C-W>J:set nohls<cr>
noremap <silent> <Leader>vgW :vimgrep /<C-r><C-a>/ %<cr>:ccl<cr><C-W>J:set nohls<cr>

" make Y consistent with C and D
nnoremap Y y$

" Code folding options
nmap <leader>f0 :set foldlevel=0<CR>
nmap <leader>f1 :set foldlevel=1<CR>
nmap <leader>f2 :set foldlevel=2<CR>
nmap <leader>f3 :set foldlevel=3<CR>
nmap <leader>f4 :set foldlevel=4<CR>
nmap <leader>f5 :set foldlevel=5<CR>
nmap <leader>f6 :set foldlevel=6<CR>
nmap <leader>f7 :set foldlevel=7<CR>
nmap <leader>f8 :set foldlevel=8<CR>
nmap <leader>f9 :set foldlevel=9<CR>

" Find merge conflict markers
map <leader>mc /\v^[<\|=>]{7}( .*\|$)<CR>

" Shortcuts
" Change Working Directory to that of the current file
cmap cwd lcd %:p:h
cmap cd. lcd %:p:h

" Visual shifting (does not exit Visual mode)
vnoremap < <gv
vnoremap > >gv

" Allow using the repeat operator with a visual selection (!)
" http://stackoverflow.com/a/8064607/127816
vnoremap . :normal .<CR>

" Fix home and end keybindings for screen, particularly on mac
" - for some reason this fixes the arrow keys too. huh.
if OSX()
    map [F $
    imap [F $
    map [H g0
    imap [H g0
endif

" For when you forget to sudo.. Really Write the file.
cmap w!! w !sudo tee % >/dev/null

" Map <Leader>fa to display all lines with keyword under cursor
" and ask which one to jump to
nmap <Leader>fa [I:let nr = input("Which one: ")<Bar>exe "normal " . nr ."[\t"<CR>

" FIXME: Revert this f70be548
" fullscreen mode for GVIM and Terminal, need 'wmctrl' in you PATH
map <silent> <F11> :call system("wmctrl -ir " . v:windowid . " -b toggle,fullscreen")<CR>

"nnoremap <leader>. :CtrlPMixed<cr>

" re-indent the buffer
noremap <Leader>= :call Preserve("normal gg=G")<cr>

" Fugitive {
    nnoremap <silent> <leader>gs :Gstatus<CR>
    nnoremap <silent> <leader>gd :Gdiff<CR>
    nnoremap <silent> <leader>gc :Gcommit<CR>
    nnoremap <silent> <leader>gb :Gblame<CR>
    nnoremap <silent> <leader>gl :Glog<CR>
    nnoremap <silent> <leader>gp :Git push<CR>
    nnoremap <silent> <leader>ge :Gedit<CR>
    nnoremap <silent> <leader>gf :Git fetch origin<CR>
    " Mnemonic _i_nteractive
    nnoremap <silent> <leader>gi :Git add -p %<CR>
"}

" Plugin key-mappings.
inoremap <expr><C-g>     neocomplcache#undo_completion()
inoremap <expr><C-l>     neocomplcache#complete_common_string()

" Intellizense
noremap <silent> <Leader>I :Intellisense<cr>

" map F12 to Toggle NERD Tree view
noremap  <silent> <F12>     :NERDTreeToggle<cr>
inoremap <silent> <F12>     :NERDTreeToggle<cr>
noremap  <Leader>tn         :NERDTreeToggle<cr>

" Tagbar mappings
noremap  <silent> <c-F12>   :TagbarToggle<cr>
inoremap <silent> <c-F12>   :TagbarToggle<cr>
noremap  <Leader>tg         :TagbarToggle<cr>

" toggle UndoTree
noremap  <silent> <c-F10>   :UndotreeToggle<cr>
inoremap <silent> <c-F10>   :UndotreeToggle<cr>
noremap  <Leader>tu         :UndotreeToggle<cr>

" trailing-whitespace setting
nmap <Leader>$ :call Preserve("%s/\\s\\+$//e")<CR>
noremap <silent> <Leader>wf :FixWhitespace<cr>
noremap <silent> <Leader>ws :highlight link ExtraWhitespace Search<cr>
noremap <silent> <Leader>wh :highlight link ExtraWhitespace None<cr>


" Unite {
    " The prefix key.

    nnoremap  <silent> <Leader>fc   :<C-u>UniteWithCurrentDir -buffer-name=files buffer file_mru file_rec/async:!<CR>
    nnoremap  <silent> <Leader>fd   :<C-u>UniteWithBufferDir -buffer-name=files buffer file_mru file_rec/async:!<CR>
    nnoremap  <silent> <Leader>fx   :<C-u>Unite source<CR>
    nnoremap  <silent> <Leader>fo   :<C-u>Unite -buffer-name=outline outline<cr>
    nnoremap  <silent> <Leader>fy   :<C-u>Unite -buffer-name=yank history/yank<cr>
    nnoremap  <silent> <Leader>fn   :<C-u>Unite -buffer-name=files jump_point file_point buffer file_rec/async:! file file/new<CR>
    nnoremap  <silent> <Leader>f/   :<C-u>Unite -buffer-name=search grep:.<cr>
    nnoremap  <silent> <Leader>fb   :<C-u>Unite -buffer-name=buffer buffer<cr>
    nnoremap  <silent> <Leader>ft   :<C-u>Unite -buffer-name=files file_mru file_rec/async:!<cr>
    nnoremap  <silent> <Leader>ff   :<C-u>Unite -buffer-name=files file_mru file_rec/async:!<cr>
    nnoremap  <silent> <Leader>fu   :<C-u>Unite -buffer-name=all buffer file_mru file_rec/async:!<CR>
    nnoremap  <silent> <Leader>fl   :<C-u>Unite line<CR>
    nnoremap  <silent> <Leader>fz   :<C-u>Unite -buffer-name=resume resume<CR>
    nnoremap  <silent> <Leader>fr   :<C-u>Unite -buffer-name=register register<CR>
    nnoremap  <silent> <Leader>fm   :<C-u>Unite output:message<CR>
    nnoremap  <silent> <Leader>fk   :<C-u>Unite -buffer-name=bookmark bookmark<cr>
    nnoremap  <silent> <Leader>ma   :<C-u>Unite mapping<cr>


    autocmd FileType unite call s:unite_my_settings()
	function! s:unite_my_settings()"{{{
	  " Overwrite settings.

      imap <buffer> jj      <Plug>(unite_insert_leave)
      " Enable navigation with control-j and control-k in insert mode
      imap <buffer> <C-j>   <Plug>(unite_select_next_line)
      imap <buffer> <C-k>   <Plug>(unite_select_previous_line)

      imap <buffer><expr> j unite#smart_map('j', '')
      imap <buffer> <C-w>     <Plug>(unite_delete_backward_path)

      imap <buffer> '     <Plug>(unite_quick_match_default_action)
      nmap <buffer> '     <Plug>(unite_quick_match_default_action)

      imap <buffer><expr> x unite#smart_map('x', "\<Plug>(unite_quick_match_choose_action)")
      nmap <buffer> x     <Plug>(unite_quick_match_choose_action)

      nmap <buffer> <C-z>     <Plug>(unite_toggle_transpose_window)
      imap <buffer> <C-z>     <Plug>(unite_toggle_transpose_window)

      imap <buffer> <C-y>     <Plug>(unite_narrowing_path)
      nmap <buffer> <C-y>     <Plug>(unite_narrowing_path)

      nmap <buffer> <C-j>     <Plug>(unite_toggle_auto_preview)

      nmap <buffer> <C-r>     <Plug>(unite_narrowing_input_history)
      imap <buffer> <C-r>     <Plug>(unite_narrowing_input_history)
      nnoremap <silent><buffer><expr> l
                  \ unite#smart_map('l', unite#do_action('default'))

      let unite = unite#get_current_unite()
      if unite.profile_name ==# 'search'
          nnoremap <silent><buffer><expr> r     unite#do_action('replace')
      else
          nnoremap <silent><buffer><expr> r     unite#do_action('rename')
      endif

	  nnoremap <silent><buffer><expr> cd     unite#do_action('lcd')
	  nnoremap <buffer><expr> S      unite#mappings#set_current_filters(
	          \ empty(unite#mappings#get_current_filters()) ?
	          \ ['sorter_reverse'] : [])
    noremap  <silent> <Leader>b :<C-u>Unite -buffer-name=buffer buffer<cr>

	  imap <silent><buffer><expr> <C-o>     unite#do_action('split')
	  imap <silent><buffer><expr> <C-v>     unite#do_action('vsplit')
	endfunction"}}}
"}


map <C-c><C-d> :Frisk -ddgoog<space>

map <C-\>   <Plug>(easymotion-sn)

" 1-character _inclusive_ Sneak (for enhanced 'f')
nmap f <Plug>Sneak_f
nmap F <Plug>Sneak_F
" visual-mode
xmap f <Plug>Sneak_f
xmap F <Plug>Sneak_F
" operator-pending-mode
omap f <Plug>Sneak_f
omap F <Plug>Sneak_F


" 1-character _exclusive_ Sneak (for enhanced 't')
nmap t <Plug>Sneak_t
nmap T <Plug>Sneak_T
" visual-mode
xmap t <Plug>Sneak_t
xmap T <Plug>Sneak_T
" operator-pending-mode
omap t <Plug>Sneak_t
omap T <Plug>Sneak_T

augroup myfiletypes

    autocmd FileType go map <C-c><C-s> :Frisk -gowalker<space>
    
    au FileType go nmap <Leader>goi <Plug>(go-info)
    au FileType go nmap <Leader>god <Plug>(go-doc)
    au FileType go nmap <Leader>govd <Plug>(go-doc-vertical)
    au FileType go nmap <Leader>gob <Plug>(go-doc-browser)
    au FileType go nmap <Leader>gos <Plug>(go-def-split)
    au FileType go nmap <Leader>govs <Plug>(go-def-vertical)

    au FileType go nmap <leader>gor <Plug>(go-run)
    au FileType go nmap <leader>gob <Plug>(go-build)
    au FileType go nmap <leader>got <Plug>(go-test)
augroup END

